- name: Configuration deployment to CVaaS
  hosts: PF_NETWORK # <-- Targeted devices
  connection: local
  gather_facts: false
  tasks:
    - name: Deploy configurations and tags to CloudVision
      ansible.builtin.import_role:
        name: arista.avd.cv_deploy
      vars:
        cv_server: www.arista.io
        cv_token: "eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCJ9.eyJkaWQiOjcwODkzNDMxODEzNjM3MTM3NTksImRzbiI6InRuZy0wNiIsImRzdCI6ImFjY291bnQiLCJleHAiOjE4MTk5ODg4NzgsImlhdCI6MTcyNDQzMDQ4MCwib2dpIjo3MDg5MzQzMTgxMzYzNzAyMjQyLCJvZ24iOiJhcmlzdGEtdG5nLTA2Iiwic2lkIjoiNzFiMjg5MDZhNDJiMDU5ZmZiNTdlN2JmZThiMzdjNDIwZGFlM2Q4ZTA3Y2FlNjg0NTczNTYwYWJiYTRhNGM1Zi1SamdFa2l5ZExfRi1lMVRSTGgwbFhaSXpoWWczMl9JMTVlSVJHZkJHIn0.YVDdrIqcHDSPj2K2hDp0Ln_lLjLRpomfM5OJ-cURvVoHQvG0Y0Wzi0OQ3xR8oADYjnqETPALpsYCDkeWmeCpFA"
        cv_run_change_control: true
# - name: Deploy config
#   hosts: PF_NETWORK
#   tasks:
#     - name: Deploy to CVaaS
#       run_once: true
#       delegate_to: localhost
#       arista.avd.cv_workflow:
#         cv_servers: ["www.arista.io"]
#         configuration_dir: "{{ inventory_dir }}/intended/configs"
#         structured_config_dir: "{{ inventory_dir }}/intended/structured_configs"
#         device_list: "{{ ansible_play_hosts }}"
#         workspace:
#           requested_state: submitted
#         change_control:
#           requested_state: pending approval
#         return_details: false


# ---
# - name: Apply configlets
#   hosts: cvaas

#   vars_files:
#     - ../vars/PF_Model.yml
#   tasks:
#     - name: Upload configlets
#       arista.cvp.cv_configlet_v3:
#         configlets: "{{ pf_configlets }}"
#     - name: Apply configlets
#       arista.cvp.cv_device_v3:
#         devices: "{{ pf_devices }}"
